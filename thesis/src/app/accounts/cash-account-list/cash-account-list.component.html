<div class="flex flex-col justify-between gap-4 sm:flex-row">
  <input hlmInput class="w-full md:w-80" placeholder="Filter accounts..." [ngModel]="_cashAccountsFilter()"
    (ngModelChange)="_rawFilterInput.set($event)" />
  <button hlmBtn brnDialogTrigger [brnDialogTriggerFor]="newDialog"
    class="justify-center rounded-sm text-white hover:text-gray-400">
    New
  </button>
</div>

<hlm-dialog #newDialog>
  <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
    <hlm-dialog-header>
      <h3 hlmDialogTitle>New Cash Account</h3>
      <p hlmDialogDescription>Add the details for the new cash account.</p>
    </hlm-dialog-header>

    <div class="py-4 grid gap-4">
      <div class="items-center grid grid-cols-4 gap-4">
        <label hlmLabel for="name" class="text-right">Account Name</label>
        <input hlmInput id="name" [(ngModel)]="newCashAccount.name" class="col-span-3" />
      </div>

      <div class="items-center grid grid-cols-4 gap-4">
        <label hlmLabel for="balance" class="text-right">Account Balance</label>
        <input type="number" hlmInput id="balance" [(ngModel)]="newCashAccount.balance" class="col-span-3" />
      </div>

      <div class="items-center grid grid-cols-4 gap-4">
        <label hlmLabel for="currency" class="text-right">Currency</label>
        <brn-select id="currency" [(ngModel)]="newCashAccount.currency" class="col-span-3">
          <hlm-select-trigger class="w-full">
            <hlm-select-value />
          </hlm-select-trigger>
          <hlm-select-content>
            <hlm-option *ngFor="let currency of currencies" [value]="currency">
              {{ currency }}
            </hlm-option>
          </hlm-select-content>
        </brn-select>
      </div>
    </div>

    <hlm-dialog-footer>
      <button hlmBtn variant="ghost" (click)="ctx.close()">Cancel</button>
      <button hlmBtn class="text-white hover:text-gray-400" (click)="addCashAccount(); ctx.close()">
        Save
      </button>
    </hlm-dialog-footer>
  </hlm-dialog-content>
</hlm-dialog>

<brn-table hlm stickyHeader class="w-full border-border mt-10 block h-8/12 overflow-auto"
  [dataSource]="_filteredSortedPaginatedBudgets()" [displayedColumns]="_allDisplayedColumns()" [trackBy]="_trackBy">
  <brn-column-def name="icon" class="w-1/12 justify-center">
    <hlm-th truncate *brnHeaderDef class="justify-center text-center">Icon</hlm-th>
    <hlm-td truncate *brnCellDef="let element" class="justify-center text-center">
      <div class="w-full h-full justify-center text-center">
        <svg class="justify-center text-center" viewBox="0 0 90 112.5" width="40px" h="40px"
          xmlns="http://www.w3.org/2000/svg">
          <g transform="matrix(1.0162279605865479, 0, 0, 1.0278929471969604, -1.2657499313354492, -0.5505840182304382)">
            <g>
              <circle cx="57" cy="48" r="2.001" />
              <path
                d="M73.026,40H72v-9.498C72,27.606,69.587,25,66.691,25H61v-0.009c0-2.896-2.231-5.252-5.127-5.252L18.238,25.25    C15.377,25.292,13,27.632,13,30.502v34.016C13,67.413,15.606,70,18.502,70h0.073h1.568h46.548C69.587,70,72,67.413,72,64.518V56    h1.026C75.921,56,78,53.708,78,50.812v-5.494C78,42.423,75.921,40,73.026,40z M55.941,21.489C57.703,21.526,59,23.22,59,24.991V25    H30.555L55.941,21.489z M70,64.748C70,66.544,68.544,68,66.748,68H18.252C16.456,68,15,66.544,15,64.748V30.252    C15,28.456,16.456,27,18.252,27h48.496C68.544,27,70,28.456,70,30.252V40H55.53C52.634,40,50,42.423,50,45.319v5.494    C50,53.708,52.634,56,55.53,56H70V64.748z M76,50.748C76,52.544,74.544,54,72.748,54H55.252C53.456,54,52,52.544,52,50.748v-5.496    C52,43.456,53.456,42,55.252,42h17.496C74.544,42,76,43.456,76,45.252V50.748z" />
            </g>
          </g>
        </svg>
      </div>
    </hlm-td>
  </brn-column-def>
  <brn-column-def name="name" class="w-6/12 justify-start text-start">
    <hlm-th *brnHeaderDef truncate>
      <button hlmBtn class="p-0" size="sm" variant="ghost" (click)="handleNameSortChange()">
        Account Name
        <hlm-icon class="ml-2" size="sm" name="lucideArrowUpDown" />
      </button>
    </hlm-th>

    <hlm-td *brnCellDef="let element" class="flex items-center gap-2">
      <ng-container *ngIf="element.isEditing; else viewMode">
        <input hlmInput [(ngModel)]="element.name" class="flex-1" name="accountName"
          (keyup.enter)="saveAccountName(element)" />
        <button hlmBtn class="text-end ml-auto p-1 hover:text-gray-600" variant="ghost"
          (click)="saveAccountName(element)">Save</button>
      </ng-container>

      <ng-template #viewMode>
        {{ element.name }}
        <button class="text-end ml-auto p-1 hover:text-gray-600" hlmBtn variant="ghost"
          (click)="toggleEditName(element)">Edit</button>
      </ng-template>
    </hlm-td>
  </brn-column-def>

  <brn-column-def name="balance" class="w-2/12 justify-start text-start">
    <hlm-th *brnHeaderDef>Balance</hlm-th>
    <hlm-td class="text-start font-medium tabular-nums" *brnCellDef="let element">
      {{ element.balance | number : '1.2-2'}}
    </hlm-td>
  </brn-column-def>
  <brn-column-def name="currency" class="w-2/12 justify-center">
    <hlm-th *brnHeaderDef>Currency</hlm-th>
    <hlm-td class="text-start font-medium tabular-nums" *brnCellDef="let element">
      {{ element.currency }}
    </hlm-td>
  </brn-column-def>

  <brn-column-def name="actions" class="w-1/12 justify-center">
    <hlm-th *brnHeaderDef></hlm-th>
    <hlm-td *brnCellDef="let element">
      <button hlmBtn variant="ghost" class="h-6 w-6 p-0.5" align="end" [brnMenuTriggerFor]="menu">
        <hlm-icon class="h-4 w-4" name="lucideMoreHorizontal" />
      </button>

      <ng-template #menu>
        <hlm-menu>
          <hlm-menu-label>Actions</hlm-menu-label>
          <hlm-menu-separator />
          <hlm-menu-group>
            <button brnDialogTrigger [brnDialogTriggerFor]="editDialog" (click)="selectCashAccount(element)">
              Edit
            </button>
          </hlm-menu-group>
          <hlm-menu-separator />
          <hlm-menu-group>
            <hlm-menu-group>
              <button brnDialogTrigger [brnDialogTriggerFor]="deleteDialog"
                (click)="selectCashAccount(element)">Delete</button>
            </hlm-menu-group> </hlm-menu-group>
        </hlm-menu>
      </ng-template>
    </hlm-td>
  </brn-column-def>
  <div class="text-muted-foreground flex items-center justify-center p-20" brnNoDataRow>
    No data
  </div>
</brn-table>

<hlm-dialog #editDialog>
  <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
    <hlm-dialog-header>
      <h3 hlmDialogTitle>Edit Account</h3>
      <p hlmDialogDescription>Modify the Account details and click save to apply changes.</p>
    </hlm-dialog-header>

    <div class="items-center grid grid-cols-4 gap-4">
      <label hlmLabel for="name" class="text-right">Account Name</label>
      <input hlmInput id="name" [(ngModel)]="selectedCashAccount.name" class="col-span-3" />
    </div>

    <div class="items-center grid grid-cols-4 gap-4">
      <label hlmLabel for="balance" class="text-right">Account Balance</label>
      <input type="number" hlmInput id="balance" [(ngModel)]="selectedCashAccount.balance" class="col-span-3" />
    </div>

    <div class="items-center grid grid-cols-4 gap-4">
      <label hlmLabel for="currency" class="text-right">Currency</label>
      <brn-select id="currency" [(ngModel)]="selectedCashAccount.currency" class="col-span-3">
        <hlm-select-trigger class="w-full">
          <hlm-select-value />
        </hlm-select-trigger>
        <hlm-select-content>
          <hlm-option *ngFor="let currency of currencies" [value]="currency">
            {{ currency }}
          </hlm-option>
        </hlm-select-content>
      </brn-select>
    </div>

    <hlm-dialog-footer>
      <button hlmBtn variant="ghost" (click)="ctx.close()">Cancel</button>
      <button hlmBtn class="text-white hover:text-gray-400" (click)="saveCashAccount(); ctx.close()">
        Save changes
      </button>
    </hlm-dialog-footer>
  </hlm-dialog-content>
</hlm-dialog>

<hlm-dialog #deleteDialog>
  <hlm-dialog-content *brnAlertDialogContent="let ctx">
    <hlm-dialog-header>
      <h3 hlmAlertDialogTitle>Are you absolutely sure?</h3>
      <p hlmAlertDialogDescription>
        This action cannot be undone. This will permanently delete your account.
      </p>
    </hlm-dialog-header>
    <hlm-dialog-footer>
      <button hlmBtn variant="ghost" (click)="ctx.close()">Cancel</button>
      <button hlmBtn variant="destructive" (click)="deleteCashAccount(); ctx.close()">Delete Account</button>
    </hlm-dialog-footer>
  </hlm-dialog-content>
</hlm-dialog>